<template>
  <b-row>
    <b-col cols="10">
      <b-form>
        <b-form-group :invalid-feedback="invalidCve">
          <b-form-input type="text" v-model="newCve" placeholder="CVE" :state="cveState" autofocus/>
        </b-form-group>
      </b-form>
    </b-col>
    <b-col cols="2">
      <b-button variant="outline" @click="create" v-b-tooltip.hover title="Create">
        <p class="h3"><b-icon variant="success" icon="plus-square-fill"/></p>
      </b-button>
    </b-col>
  </b-row>
</template>

<script>
import RekonoApi from '@/backend/RekonoApi';
export default {
  name: 'targetVulnerability',
  mixins: [RekonoApi],
  props: {
    targetPortId: Number,
  },
  data () {
    return {
      newCve: null,
      invalidCve: 'CVE is required',
      cveState: null,
    }
  },
  methods: {
    check () {
      this.cveState = null
      if (!this.validateCve(this.newCve)) {
        this.cveState = false
        this.invalidCve = this.newCve && this.newCve.length > 0 ? 'Invalid CVE' : 'CVE is required'
        return false
      }
      return true
    },
    create () {
      if (this.check()) {
        this.post(
          '/api/target-vulnerabilities/',
          { target_port: this.targetPortId, cve: this.newCve },
          this.newCve, `New target ${this.name} created successfully`
        )
          .then(() => this.$emit('update'))
        this.clean()
      }
    },
    clean () {
      this.newCve = null
      this.invalidCve = 'CVE is required'
      this.cveState = null
    }
  }
}
</script>